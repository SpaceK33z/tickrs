## 2026-01-13: Fixed compilation errors and failing tests

### Problem
The project had compilation errors in two files:
1. `src/config/mod.rs` - Raw string literals with `#` characters were not being parsed correctly
2. `src/models/project.rs` - Same issue with JSON test strings containing `#FF5733` color codes

Additionally, `test_config_default` was failing because `#[derive(Default)]` doesn't apply serde default functions.

### Solution
1. Replaced multi-line raw string literals (`r#"..."#`) with single-line escaped strings
2. Implemented `Default` trait manually for `Config` struct to properly use the `default_project_color()` function

### Changes Made
- `src/config/mod.rs`:
  - Changed `test_config_deserialization` to use escaped string instead of raw string
  - Added manual `impl Default for Config` to ensure `default_project_color` is applied
- `src/models/project.rs`:
  - Changed `test_project_deserialization` to use escaped JSON string
  - Changed `test_project_data_deserialization` to use escaped JSON string

### Results
- All 23 tests pass
- Project compiles successfully
- Clippy shows only expected dead_code warnings (code not yet used) and minor suggestions

## 2026-01-14: Fixed missing INBOX_PROJECT_ID export

### Problem
The project had a compilation error - `INBOX_PROJECT_ID` was defined in `src/models/project.rs` but not exported from `src/models/mod.rs`, causing `src/api/project.rs` to fail compilation.

### Solution
Added `INBOX_PROJECT_ID` to the public exports in `src/models/mod.rs`.

### Changes Made
- `src/models/mod.rs`:
  - Added `INBOX_PROJECT_ID` to the `pub use project::` statement

### Results
- All 27 tests pass
- Project compiles successfully
- Clippy shows only expected dead_code warnings (code not yet used)

## 2026-01-14: Implemented Phase 6 - Task API Endpoints

### What was done
Implemented all task-related API endpoints in `src/api/task.rs` as specified in PRD Phase 6.

### API Methods Implemented
1. `list_tasks(project_id)` - List all tasks in a project (uses GET /project/{id}/data)
2. `get_task(project_id, task_id)` - Get single task (GET /project/{projectId}/task/{taskId})
3. `create_task(request)` - Create new task (POST /task)
4. `update_task(task_id, request)` - Update task (POST /task/{id})
5. `delete_task(project_id, task_id)` - Delete task (DELETE /project/{projectId}/task/{taskId})
6. `complete_task(project_id, task_id)` - Mark complete (POST /project/{projectId}/task/{taskId}/complete)
7. `uncomplete_task(project_id, task_id)` - Mark incomplete (updates status to 0)

### Request Types Added
- `CreateTaskRequest` - For creating tasks with optional fields (content, priority, dates, tags, etc.)
- `UpdateTaskRequest` - For updating tasks with optional fields including status

### Changes Made
- `src/api/task.rs`: Complete implementation with 7 API methods and 2 request types
- `src/api/mod.rs`: Added exports for `CreateTaskRequest` and `UpdateTaskRequest`

### Results
- All 31 tests pass (4 new tests for task request serialization)
- Project compiles successfully
- Clippy shows only expected dead_code warnings (CLI not yet implemented)

## 2026-01-14: Implemented Phase 7 - Output Formatting

### What was done
Implemented the output formatting module in `src/output/` as specified in PRD Phase 7.

### Module Structure
- `src/output/mod.rs` - Module exports and `OutputFormat` enum (Text/Json)
- `src/output/json.rs` - JSON output formatting with standard response wrapper
- `src/output/text.rs` - Text output formatting for human-readable output

### JSON Output Implementation
- `JsonResponse<T>` - Generic response wrapper with success, data, error, and message fields
- `ErrorDetail` - Error details with code, message, and optional details
- Helper functions: `result_to_json`, `result_to_json_with_message`
- Data wrappers: `ProjectListData`, `ProjectData`, `TaskListData`, `TaskData`, `SubtaskListData`, `VersionData`
- All responses match PRD JSON specification format

### Text Output Implementation
- `format_project_list` / `format_project_details` - Project formatting
- `format_task_list` / `format_task_details` - Task formatting with priority markers [L]/[M]/[H]
- `format_subtask_list` - Subtask/checklist item formatting
- `format_success` / `format_success_with_id` / `format_error` - Status message formatting
- `format_version` - Version info formatting

### Changes Made
- Created `src/output/mod.rs`
- Created `src/output/json.rs` with 7 tests
- Created `src/output/text.rs` with 12 tests
- Updated `src/main.rs` to include output module

### Results
- All 50 tests pass (19 new tests for output module)
- Project compiles successfully
- Clippy shows only expected dead_code warnings (CLI not yet wired up)

## 2026-01-14: Implemented Phase 8 - Utilities

### What was done
Implemented the utilities module as specified in PRD Phase 8, including date parsing and error handling.

### Module Structure
- `src/utils/mod.rs` - Module exports
- `src/utils/date_parser.rs` - Natural language date parsing
- `src/utils/error.rs` - Application error types with error codes
- `src/constants.rs` - Centralized constants

### Date Parser Implementation (`utils/date_parser.rs`)
- `parse_date(input)` - Parse natural language or ISO dates to `DateTime<Utc>`
  - Supports: "today", "tomorrow", "yesterday", "next week", "next month"
  - Supports: "in X days/hours/minutes/weeks/months"
  - Supports: ISO 8601 formats via dateparser crate
- `parse_date_with_timezone(input, timezone)` - Parse with specific timezone
- `parse_future_date(input)` - Parse and validate date is not in the past
- `format_datetime(dt, timezone)` - Format datetime for display
- `local_timezone()` - Get system timezone
- `DateParseError` enum with user-friendly messages

### Error Handling Implementation (`utils/error.rs`)
- `ErrorCode` enum - Serializable error codes for JSON output:
  - AUTH_REQUIRED, AUTH_EXPIRED, NOT_FOUND, INVALID_REQUEST
  - RATE_LIMITED, SERVER_ERROR, NETWORK_ERROR, PARSE_ERROR
  - CONFIG_ERROR, INVALID_DATE, NO_PROJECT, UNKNOWN
- `AppError` enum - User-friendly error messages with actionable guidance
- Conversion implementations from `ApiError`, `DateParseError`, and `anyhow::Error`

### Constants Implementation (`constants.rs`)
- API constants: `API_BASE_URL`
- OAuth constants: `OAUTH_AUTH_URL`, `OAUTH_TOKEN_URL`, `OAUTH_REDIRECT_URI`, `OAUTH_SCOPES`
- Project constants: `INBOX_PROJECT_ID`, `INBOX_PROJECT_NAME`, `DEFAULT_PROJECT_COLOR`
- File constants: `CONFIG_FILE_NAME`, `TOKEN_FILE_NAME`, `APP_DIR_NAME`
- Environment variables: `ENV_CLIENT_ID`, `ENV_CLIENT_SECRET`, `ENV_LOG_LEVEL`, `DEFAULT_LOG_LEVEL`

### Changes Made
- Created `src/utils/mod.rs`
- Created `src/utils/date_parser.rs` with 13 tests
- Created `src/utils/error.rs` with 5 tests
- Created `src/constants.rs` with 6 tests
- Updated `src/main.rs` to include utils and constants modules

### Results
- All 74 tests pass (24 new tests)
- Project compiles successfully
- Clippy shows only expected dead_code warnings (CLI not yet wired up)

## 2026-01-14: Implemented Phase 9 - CLI Root Commands

### What was done
Implemented the CLI root commands (init, reset, version) as specified in PRD Phase 9.

### OAuth Authentication (`api/auth.rs`)
- `AuthHandler` struct for managing OAuth flow
- `get_auth_url()` - Generates authorization URL with CSRF token
- `run_oauth_flow()` - Full OAuth flow: open browser, capture callback, exchange code
- `capture_callback()` - TCP listener on localhost:8080 to capture authorization code
- `exchange_code()` - Exchange authorization code for access token
- Uses oauth2 crate v5 with proper type configuration
- HTML success/error pages displayed after authorization

### CLI Commands Implemented
- **`tickrs init`** - OAuth authentication flow
  - Checks if already authenticated
  - Loads client credentials from environment variables
  - Opens browser for TickTick authorization
  - Captures callback and exchanges code for token
  - Saves token and initializes config
  - Supports `--json` output

- **`tickrs reset`** - Clear configuration and credentials
  - Checks if anything exists to reset
  - Confirmation prompt (skippable with `--force`)
  - Deletes token and config files
  - Supports `--json` output

- **`tickrs version`** - Display version information
  - Shows name and version from Cargo.toml
  - Supports `--json` and `--quiet` flags

### Main Entry Point (`main.rs`)
- Async runtime with tokio
- Command dispatch with proper error handling
- Output format handling (JSON/Text)
- Quiet mode support
- Exit codes for success/failure

### Changes Made
- `src/api/auth.rs`: Full OAuth implementation with 8 tests
- `src/api/mod.rs`: Added `AuthHandler` export
- `src/cli/mod.rs`: Added `Commands` export
- `src/main.rs`: Complete command dispatch and handlers

### Results
- All 82 tests pass (8 new tests for OAuth)
- Project compiles successfully
- CLI commands work correctly:
  - `tickrs version` outputs "tickrs 0.1.0"
  - `tickrs --json version` outputs proper JSON
  - `tickrs reset --force` handles no-config case
  - `tickrs --help` shows all commands
- Clippy shows only expected dead_code warnings (later phases not yet implemented)

## 2026-01-14: Implemented Phase 10 - CLI Project Commands

### What was done
Implemented all project CLI commands in `main.rs` as specified in PRD Phase 10.

### Commands Implemented
1. **`project list`** (alias: `ls`)
   - Lists all projects from TickTick API (including INBOX)
   - Supports `--json` output for machine consumption
   - Text output shows ID, name, and color

2. **`project show <id>`**
   - Shows detailed information about a specific project
   - Supports `--json` output
   - Text output shows all project fields

3. **`project use <name-or-id>`**
   - Sets the default project for subsequent commands
   - Finds project by ID or name (case-insensitive)
   - Saves selection to config file

4. **`project create`**
   - Creates a new project with specified options
   - Flags: `--name` (required), `--color`, `--view-mode`, `--kind`
   - Returns created project with ID

5. **`project update <id>`**
   - Updates an existing project
   - Flags: `--name`, `--color`, `--closed`
   - Returns updated project

6. **`project delete <id>`**
   - Deletes a project (with confirmation prompt)
   - Use `--force` to skip confirmation
   - Works with `--json` flag to skip prompt

### Changes Made
- `src/main.rs`:
  - Added imports for `CreateProjectRequest`, `UpdateProjectRequest`, `TickTickClient`
  - Added imports for `ProjectData`, `ProjectListData` output wrappers
  - Wired up `Commands::Project` to `cmd_project` handler
  - Implemented `cmd_project` dispatcher function
  - Implemented `cmd_project_list` - lists all projects
  - Implemented `cmd_project_show` - shows project details
  - Implemented `cmd_project_use` - sets default project
  - Implemented `cmd_project_create` - creates new project
  - Implemented `cmd_project_update` - updates existing project
  - Implemented `cmd_project_delete` - deletes project with confirmation

### Results
- All 82 tests pass
- Project compiles successfully
- All project commands work with both `--json` and text output
- `ls` alias works for `list` command
- Clippy shows only expected dead_code warnings (task/subtask commands not yet implemented)

## 2026-01-14: Implemented Phase 11 - CLI Task Commands

### What was done
Implemented all task CLI commands in `main.rs` as specified in PRD Phase 11.

### Commands Implemented
1. **`task list`** (alias: `ls`)
   - Lists all tasks in a project
   - Optional `--project-id` or uses default from config
   - Optional filters: `--priority`, `--tag`, `--status`
   - Supports `--json` output
   - Text output shows checkbox, priority marker, title, and due date

2. **`task show <id>`**
   - Shows detailed information about a specific task
   - Optional `--project-id` or uses default
   - Supports `--json` output
   - Text output shows all task fields including subtasks

3. **`task create`** (alias: `add`)
   - Creates a new task with specified options
   - Required: `--title`
   - Optional flags: `--project-id`, `--content`, `--priority`, `--tags`, `--date`, `--start`, `--due`, `--all-day`, `--timezone`
   - Natural language date parsing (e.g., "tomorrow", "in 3 days")
   - Returns created task with ID

4. **`task update <id>`**
   - Updates an existing task
   - Same flags as create (except --title is optional)
   - Returns updated task

5. **`task delete <id>`**
   - Deletes a task (with confirmation prompt)
   - Optional `--project-id`
   - Use `--force` to skip confirmation

6. **`task complete <id>`**
   - Marks a task as complete
   - Optional `--project-id`

7. **`task uncomplete <id>`**
   - Marks a task as incomplete
   - Optional `--project-id`

### Key Features
- **Default Project Support**: All task commands use the default project from config if `--project-id` is not specified
- **Filtering**: List command supports filtering by priority, tag, and status (complete/incomplete)
- **Natural Language Dates**: The `--date` flag accepts expressions like "today", "tomorrow", "in 3 days"
- **Tags**: Comma-separated tags can be specified with `--tags`

### Changes Made
- `src/main.rs`:
  - Added imports for `CreateTaskRequest`, `UpdateTaskRequest`, `TaskCommands`
  - Added imports for `TaskData`, `TaskListData` output wrappers
  - Added imports for `Priority`, `Status`, and `parse_date`
  - Wired up `Commands::Task` to `cmd_task` handler
  - Implemented `cmd_task` dispatcher function
  - Implemented `get_project_id` helper function for default project resolution
  - Implemented `cmd_task_list` - lists tasks with optional filtering
  - Implemented `cmd_task_show` - shows task details
  - Implemented `cmd_task_create` - creates new task with date parsing
  - Implemented `cmd_task_update` - updates existing task
  - Implemented `cmd_task_delete` - deletes task with confirmation
  - Implemented `cmd_task_complete` - marks task complete
  - Implemented `cmd_task_uncomplete` - marks task incomplete
  - Implemented `parse_task_dates` - parses date options into API format

### Results
- All 82 tests pass
- Project compiles successfully
- All task commands work with both `--json` and text output
- `ls` alias works for `list` command, `add` alias works for `create`
- Date parsing integrates with natural language support
- Clippy shows only expected dead_code warnings (subtask commands not yet implemented)

## 2026-01-14: Implemented Phase 12 - CLI Subtask Commands

### What was done
Implemented the subtask list command in `main.rs` as specified in PRD Phase 12.

### Commands Implemented
1. **`subtask list <task-id>`** (alias: `ls`)
   - Lists all subtasks (checklist items) for a given task
   - Optional `--project-id` or uses default from config
   - Supports `--json` output
   - Text output shows checkbox status and title for each subtask

### Key Features
- **Default Project Support**: Uses the default project from config if `--project-id` is not specified
- **JSON Output**: Returns structured JSON with subtasks array and count
- **Text Output**: Displays human-readable list with status markers [x]/[ ]

### Changes Made
- `src/main.rs`:
  - Added import for `SubtaskCommands`
  - Added import for `SubtaskListData` output wrapper
  - Wired up `Commands::Subtask` to `cmd_subtask` handler
  - Implemented `cmd_subtask` dispatcher function
  - Implemented `cmd_subtask_list` - lists subtasks for a task

### Results
- All 82 tests pass
- Project compiles successfully
- Subtask list command works with both `--json` and text output
- `ls` alias works for `list` command
- Clippy shows only expected dead_code warnings (later phases not yet implemented)
